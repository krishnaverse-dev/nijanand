function showHome() {
    window.location.href = 'index.html';
}

function toggleMenu() {
    const overlay = document.getElementById('navOverlay');
    overlay.classList.toggle('active'); // overlay को show/hide
}

window.onload = function() {
    // LocalStorage me check karein ki kya user pehle aa chuka hai
    if (!localStorage.getItem('hasVisited')) {
        // Agar pehli baar hai, toh popup dikhayein
        setTimeout(() => {
            document.getElementById('welcome-popup').style.display = 'flex';
        }, 1000); // 1 second ke delay ke baad dikhega (optional)
        
        // Mark karein ki user ne visit kar liya hai
        localStorage.setItem('hasVisited', 'true');
    }
};

function closePopup() {
    document.getElementById('welcome-popup').style.display = 'none';
}

const nodeInfo = {
  "अक्षरातीत (पुर्णब्रम्ह)": "सर्वोच्च सत्ता, प्रेम और आनंद के सागर, जो माया और अक्षर ब्रह्म से भी परे हैं।",
  "अक्षरातीत का परमधाम": "अखंड, अविनाशी दिव्य धाम जहाँ श्री राज-श्यामाजी और सखियाँ निवास करती हैं।",
  "बड़ी रांग": "परमधाम के चारों ओर फैला हुआ दिव्य बगीचों और वनों का समूह।",
  "सागर मंडल": "परमधाम को घेरे हुए आठ दिव्य रसात्मक सागरों का मंडल।",
  "नूर सागर": "परमधाम का सागर, जो दिव्य प्रकाश (नूर) से परिपूर्ण है।",
  "क्षीर सागर": "परमधाम का  सागर, जो दूध के समान उज्ज्वल और मधुर है।",
  "दधि सागर": "परमधाम का सागर, जो दही के समान रसात्मक है।",
  "घृत सागर": "परमधाम का सागर, जो घी के समान चिकना और दिव्य है।",
  "मधु सागर": "परमधाम का सागर, जो शहद के समान मीठा है।",
  "रस सागर": "परमधाम का सागर, जो समस्त दिव्य रसों का पुंज है।",
  "नीर सागर": "परमधाम का सागर, जो निर्मल जल के समान है।",
  "सर्वरस सागर": "परमधाम का सागर, जिसमें सभी रसों का समावेश है।",
  "चाँदनी चौक": "रंगमहल के सामने का विशाल चौक जहाँ दिव्य लीलाएँ होती हैं।",
  "यमुनाजी": "परमधाम की मुख्य दिव्य नदी जो वनों के मध्य से प्रवाहित होती है।",
  "अमृत वन": "दिव्य सुगंधित फूलों और फलों वाला वन, जो अमृत के समान आनंद देता है।",
  "पाट घाट": "यमुनाजी के किनारे बना मुख्य सुंदर घाट।",
  "बट वन": "विशाल बरगद के वृक्षों वाला दिव्य वन।",
  "नारंगी वन": "नारंगी के वृक्षों से सुसज्जित दिव्य उपवन।",
  "जम्बु वन": "जामुन के वृक्षों वाला सुंदर वन।",
  "अनार वन": "अनार के वृक्षों वाला दिव्य स्थान।",
  "लिबोई वन": "नीम और मीठे फलों वाला सुंदर वन।",
  "केल वन": "केल के झुरमुटों वाला सुंदर बगीचा।",
  "रंग महल": "परमधाम का मुख्य महल, जहाँ श्री राजजी का सिंहासन है और मुख्य लीलाएँ होती हैं।",
  "बट पीपल चौकी": "यमुना तट पर बट और पीपल के वृक्षों की सुंदर बैठक।",
  "खडोकली लाल चबूतरा": "परमधाम का एक मुख्य लीला स्थल, जो लाल रंग के पत्थरों से बना सुंदर चबूतरा है।",
  "ताड़ वन": "ताड़ के ऊँचे वृक्षों वाला दिव्य वन।",
  "बडो वन": "एक विशाल और घना दिव्य वन।",
  "मधु वन": "अत्यंत मीठे फलों और मधुमक्खियों के गुंजन वाला वन।",
  "महा वन": "परमधाम की परिधि में स्थित एक विशाल वन क्षेत्र।",
  "उतर घाटी वन": "परमधाम की उत्तर दिशा में स्थित घाटियों का वन।",
  "पुखराजगिरी महल": "पुखराज पर्वत पर स्थित दिव्य और जगमगाता महल।",
  "पश्चिम घाटी वन": "परमधाम की पश्चिम दिशा का रमणीय वन।",
  "चोगान": "दिव्य खेल और क्रीड़ा करने का खुला मैदान।",
  "अन्न धन": "परमधाम की सुख-समृद्धि का प्रतीक क्षेत्र।",
  "दूध दलीचा": "श्वेत और कोमल फर्श के समान स्थान, जहाँ सखियाँ विश्राम करती हैं।",
  "फुल बाग": "भाँति-भाँति के सुगंधित पुष्पों का बगीचा।",
  "नूर बाग": "नूरानी (प्रकाशित) वृक्षों और लताओं वाला बाग।",
  "होजकोशर ताल (सुधासर)": "अमृत जैसा जल वाला पवित्र सरोवर।",
  "माणिक महल": "माणिक्य (मणियों) से जड़ा हुआ दिव्य प्रकाशमान महल।",
  "अक्षर धाम": "अक्षर ब्रह्म का निवास स्थान, जो परमधाम के नीचे स्थित है।",
  "कुंज निकुंज": "परमधाम की सघन लताओं और वृक्षों के मध्य एकांत क्रीड़ा स्थल।",
  "अक्षरब्रह्म (सत्स्वरूप)": "परमात्मा का वह स्वरूप जो सृष्टि की उत्पत्ति और लय का आधार है।",
  "महाकारण": "अक्षर ब्रह्म की वह अवस्था जहाँ से सृष्टि का बीज अंकुरित होता है।",
  "ब्रह्म नग्न सत्य (अव्याकृत)": "वह अवस्था जहाँ द्वैत का पूर्ण अभाव है, केवल सत्य का भान है।",
  "जोश स्वरूप": "अक्षरातीत की वह शक्ति जो ब्रह्मांड में क्रियाशीलता लाती है।",
  "बुद्ध स्वरूप": "अक्षर ब्रह्म की चैतन्य बुद्धि का स्वरूप।",
  "सत्स्वरूप": "अविनाशी सत्ता का स्वरूप।",
  "स्वामिनी": "परमधाम की मुख्य शक्ति, श्री श्यामाजी।",
  "अक्षरब्रह्म (प्रकृति–पुरुष)": "सृष्टि के सृजन के लिए पुरुष और प्रकृति का संयुक्त कारण रूप।",
  "गोलोक धाम": "नित्य राधा-कृष्ण का निवास स्थान।",
  "नित्य बैकुंठ": "श्री विष्णु और लक्ष्मी जी का शाश्वत निवास।",
  "सत्य लोक": "ब्रह्माजी का उच्च लोक।",
  "विष्णु लोक": "वैकुंठ का वह भाग जहाँ पालनहार विष्णु निवास करते हैं।",
  "पुष्कर द्वीप": "एक दिव्य द्वीप।",
  "श्वेत द्वीप": "क्षीर सागर के मध्य स्थित भगवान विष्णु का निवास।",
  "आवरण शक्ति": "माया की वह शक्ति जो सत्य को छिपा देती है।",
  "विक्षेप शक्ति": "माया की वह शक्ति जो असत्य को सत्य जैसा दिखाती है।",
  "सुमंगला शक्ति (चिदानंद लहरी)": "शिव कल्याणी शक्ति आनंद और शुभ फल वाली ईश्वरीय शक्ति।",
  "महाविष्णु": "अनंत कोटि ब्रह्मांडों के अधिपति।",
  "शिव": "संहार के अधिपति और परम योगी।",
  "सनकादिक": "ब्रह्मा के चार मानस पुत्र, जो ज्ञान के प्रतीक हैं।",
  "सुकदेव": "श्रीमद्भागवत के वक्ता और महान परमहंस।",
  "कबीर": "सत्यलोक की बात करने वाले महान संत और निर्गुण उपासक।",
  "अव्याकृत ब्रह्म": "अक्षर ब्रह्म का वह अंग जहाँ मूल माया का निवास है।",
  "अव्याकृत ब्रह्म का कारण": "परब्रह्म पर आश्रित मायाशक्ति की अनादि अवस्था; कारण-कार्य से परे।",
  "वास्तवि शक्ति": "परम सत्य की वास्तविक सामर्थ्य।",
  "अनिर्वचनीय शक्ति": "वह शक्ति जिसका शब्दों में वर्णन असंभव है।",
  "उनमुनी शक्ति": "ध्यान की उच्चतम अवस्था की शक्ति।",
  "इच्छा शक्ति": "सृष्टि के निर्माण की संकल्प शक्ति।",
  "तृच्छा शक्ति": "मायावी आकर्षण की शक्ति।",
  "शिव कल्याणी शक्ति": "शिव कल्याण करने वाली स्वरूपा शक्ति।",
  "सात शून्य": "महाप्रलय के समय जो सात शून्य अवस्थाएँ आती हैं।",
  "सात स्वर": "सृष्टि की नाद ब्रह्म की ध्वनियाँ।",
  "सूक्ष्म": "इंद्रियों से परे का सूक्ष्म स्तर।",
  "अध्यात्म": "आत्मा और परमात्मा का अंतर्संबंध।",
  "अधिदैव": "दैवीय शक्तियों का अधिष्ठान।",
  "अधिभूत": "पंचतत्वों से निर्मित भौतिक जगत।",
  "स्थूल": "दिखाई देने वाला भौतिक स्वरूप।",
  "परप्रणव ब्रह्म": "ओंकार (ॐ) से भी परे का नाद स्वरूप।",
  "ज्ञान शक्ति गायत्री": "वेदों की जननी और बुद्धि को प्रेरित करने वाली शक्ति।",
  "पाँच वेद": "चार वेदों के साथ पंचम वेद को मिलाकर पांचवाँ वेद।",
  "अपर परप्रणव ब्रह्म": "अक्षर ब्रह्म की वह सूक्ष्म नाद शक्ति जो परा-शक्ति और व्यक्त सृष्टि के बीच की कड़ी है, जो महाकारण स्तर पर सृष्टि के प्रकटीकरण का आधार बनती है।",
  "ॐ": "ब्रह्मांड की मूल ध्वनि।",
  "केवल ब्रह्म": "अक्षर ब्रह्म की वह अवस्था जो पूर्णतः निर्लेप है।",
  "आनंद योगमाया": "भगवान की वह शक्ति जो दिव्य लीलाओं को संभव बनाती है।",
  "हिंडोला योगमाया मंडल": "दिव्य झूलों और आनंद की लीला का क्षेत्र।",
  "सबलीक ब्रह्म": "अक्षर ब्रह्म की वह अवस्था जिसमें सृष्टि का संकल्प उदय होता है।",
  "सबलीक ब्रह्म का महाकारण": "अक्षर ब्रह्म के सबलीक स्वरूप का वह अत्यंत सूक्ष्म और चैतन्य आधार (बीज रूप), जहाँ अखंड महारास की दिव्य लीला का आनंद शाश्वत रूप से विद्यमान है।",
  "अखंड महारास": "गोलोक में होने वाला शाश्वत प्रेम नृत्य।",
  "नित्य गोलोक": "वह गोलोक जो प्रलय में भी नष्ट नहीं होता।",
  "क्षर पुरुष": "विनाशशील सृष्टि का अधिपति, जो स्वप्न वत है।",
  "मोह जल": "सृष्टि को बांधने वाला मोह रूपी जल।",
  "आदि नारायण (चार व्यूह)": "सृष्टि के चार मुख्य रूप।",
  "वासुदेव": "परमात्मा का व्यापक स्वरूप।",
  "संकर्षण": "जीव तत्व के अधिष्ठाता।",
  "प्रद्युम्न": "मन के अधिष्ठाता।",
  "अनिरुद्ध": "अहंकार के अधिष्ठाता।",
  "कारण शरीर": "संस्कारों और अविद्या का मूल।",
  "सूक्ष्म शरीर": "मन, बुद्धि और प्राणों का अदृश्य शरीर।",
  "विद्या शक्ति": "मुक्ति दिलाने वाला ज्ञान।",
  "महा विद्या शक्ति": "परम सत्य का बोध कराने वाली परा विद्या।",
  "सुमना शक्ति": "मन को शुद्ध और स्थिर करने वाली वह शक्ति जो जीव को सात्विकता की ओर ले जाती है।",
  "स्थूल शरीर": "दिखाई देने वाला भौतिक शरीर।",
  "चार वेद": "ऋग्वेद, यजुर्वेद, सामवेद, अथर्ववेद।",
  "ज्योति स्वरूप (गायत्री)": "क्षर पुरुष (आदि नारायण) की वह आदि शक्ति, जिससे इस भौतिक ब्रह्मांड का प्रकाश और ऊर्जा उत्पन्न होती है।",
  "चमोचक शक्ति": "ज्योति स्वरूप गायत्री की वह शक्ति, जो अंधकार का निवारण कर सृष्टि के प्रकटीकरण की शुरुआत करती है।",
  "इधीद्वीपा शक्ति": "गायत्री की वह शक्ति, जो दिव्य प्रकाश को द्वीपों और लोकों में विस्तारित (Illuminating) करने का कार्य करती है।",
  "मध्यमा शक्ति": "गायत्री की वह शक्ति, जो सृष्टि के संतुलन और मध्यवर्ती ऊर्जा प्रवाह को नियंत्रित करती है।",
  "परमा शक्ति": "ज्योति स्वरूप की वह उच्च शक्ति, जो ऊर्जा को उसकी पराकाष्ठा और पूर्ण सामर्थ्य प्रदान करती है।",
  "उध्द्रगा शक्ति": "गायत्री की वह शक्ति, जो ऊर्जा को ऊपर की ओर (Ascending) प्रवाहित कर उच्च सूक्ष्म लोकों का आधार बनती है।",
  "अष्ट आवरण (नित्य प्रलय)": "प्रकृति के आठ आवरण जो ब्रह्मांड को घेरे हुए हैं।",
  "पंचमहाभूत": "सृष्टि के निर्माण के पाँच मूल तत्व जिनसे भौतिक जगत बना है।",
  "भूमि": "कठोरता और स्थिर तत्व (मिट्टी), जो शरीर और संसार का आधार है।",
  "जल": "शीतलता और रस तत्व, जो जीवन और तरलता प्रदान करता है।",
  "अग्नि": "तेज और ताप तत्व, जो रूपांतरण और ऊर्जा का मुख्य स्रोत है।",
  "वायु": "गति और स्पर्श तत्व, जो प्राण बनकर शरीर का संचालन करती है।",
  "आकाश": "शून्यता और शब्द तत्व, जो अन्य सभी तत्वों को स्थान (space) प्रदान करता है।",
  "अंतःकरण": "मनुष्य की आंतरिक चेतना के अंग।",
  "मन": "संकल्प और विकल्प (विचारों का आना-जाना) करने वाली आंतरिक शक्ति।",
  "बुद्धि": "निश्चय करने वाली और सही-गलत का निर्णय लेने वाली विवेक शक्ति।",
  "अहंकार": "स्वयं की पृथक पहचान या 'मैं' होने का भाव, जो कर्तापन का बोध कराता है।",
  "लोक (ब्रह्मांड)": "(universe)अलग अलग जीवों के लिए अलग अलग स्थान।",
  "सत्यलोक": "ब्रह्माजी का सर्वोच्च लोक।",
  "तपलोक": "तपस्वियों का लोक।",
  "जनलोक": "सिद्ध पुरुषों का लोक।",
  "महरलोक": "महान ऋषियों का लोक।",
  "स्वर्गलोक": "देवताओं का निवास स्थान।",
  "भुवर्लोक": "वायुमंडल और अंतरिक्ष।",
  "भूलोक (पृथ्वी)": "कर्मभूमि, जहाँ मनुष्य निवास करते हैं।",
  "अतल": "बलासुर दानव का लोक।",
  "वितल": "भगवान शिव “हाटकेश्वर” रूप का स्थान।",
  "सुतल": "बलि राजा का लोक।",
  "तलातल": "मयासुर का लोक।",
  "महातल": "नागों का लोक।",
  "रसातल": "दैत्यों और दानवों का लोक।",
  "पाताल": "नागों और वासुकी का सबसे नीचे का लोक।",
  "शेषशायी नारायण": "कारण जल में शेषनाग पर शयन करने वाले भगवान का स्थान।"
};
        // --- 2. D3 DATA (Your Full Hierarchy) ---
        const treeData = {
        name: "अक्षरातीत (पुर्णब्रम्ह)",
        children: [
            {
                name: "अक्षरातीत का परमधाम",
                children: [
                    {
                        name: "बड़ी रांग",
                        children: [
                            {
                                name: "सागर मंडल",
                                children: [
                                    { name: "दधि सागर" },
                                    { name: "घृत सागर" },
                                    { name: "रस सागर" },
                                    { name: "मधु सागर" },
                                    { name: "सर्वरस सागर" },
                                    { name: "नूर सागर" },
                                    { name: "नीर सागर" },
                                    { name: "क्षीर सागर" }
                                ]
                            },
                            {
                                name: "चाँदनी चौक",
                                children: [
                                    { name: "यमुनाजी" },
                                    { name: "अमृत वन" },
                                    { name: "पाट घाट" },
                                    { name: "बट वन" },
                                    { name: "नारंगी वन" },
                                    { name: "जम्बु वन" },
                                    { name: "अनार वन" },
                                    { name: "लिबोई वन" },
                                    { name: "केल वन" },
                                    { name: "रंग महल" },
                                    { name: "बट पीपल चौकी" },
                                    { name: "खडोकली लाल चबूतरा" },
                                    { name: "ताड़ वन" },
                                    { name: "बडो वन" },
                                    { name: "मधु वन" },
                                    { name: "महा वन" },
                                    { name: "उतर घाटी वन" },
                                    { name: "पुखराजगिरी महल" },
                                    { name: "पश्चिम घाटी वन" },
                                    { name: "चोगान" },
                                    { name: "अन्न धन" },
                                    { name: "दूध दलीचा" },
                                    { name: "फुल बाग" },
                                    { name: "नूर बाग" },
                                    { name: "होजकोशर ताल (सुधासर)" },
                                    { name: "माणिक महल" }
                                ]
                            },
                            {
                                name: "अक्षर धाम",
                                children: [
                                    { name: "कुंज निकुंज" },
                                    { name: "बट वन" },
                                    { name: "नारंगी वन" },
                                    { name: "जम्बु वन" },
                                    { name: "अनार वन" },
                                    { name: "लिबोई वन" },
                                    { name: "केल वन" },
                                    { name: "अमृत वन" }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                name: "अक्षरब्रह्म (सत्स्वरूप)",
                children: [
                    {
                        name: "महाकारण",
                        children: [
                            {
                                name: "ब्रह्म नग्न सत्य (अव्याकृत)",
                                children: [
                                    { name: "जोश स्वरूप" },
                                    { name: "बुद्ध स्वरूप" }
                                ]
                            }
                        ]
                    },
                    { name: "सत्स्वरूप" },
                    { name: "स्वामिनी" }
                ]
            },
            {
                name: "अक्षरब्रह्म (प्रकृति–पुरुष)",
                children: [
                    { name: "गोलोक धाम" },
                    {
                        name: "नित्य बैकुंठ",
                        children: [
                            { name: "सत्य लोक" },
                            { name: "विष्णु लोक" },
                            { name: "पुष्कर द्वीप" },
                            { name: "श्वेत द्वीप" }
                        ]
                    },
                    { name: "आवरण शक्ति" },
                    { name: "विक्षेप शक्ति" },
                    {
                        name: "सुमंगला शक्ति (चिदानंद लहरी)",
                        children: [
                            { name: "महाविष्णु" },
                            { name: "शिव" },
                            { name: "सनकादिक" },
                            { name: "सुकदेव" },
                            { name: "कबीर" }
                        ]
                    }
                ]
            },
            {
                name: "अव्याकृत ब्रह्म",
                children: [
                    {
                        name: "अव्याकृत ब्रह्म का कारण",
                        children: [
                            { name: "वास्तवि शक्ति" },
                            { name: "अनिर्वचनीय शक्ति" },
                            { name: "उनमुनी शक्ति" },
                            { name: "इच्छा शक्ति" },
                            { name: "तृच्छा शक्ति" },
                            { name: "शिव कल्याणी शक्ति" },
                            { name: "सात शून्य" }
                        ]
                    },
                    {
                        name: "सूक्ष्म",
                        children: [
                            { name: "अध्यात्म" },
                            { name: "अधिदैव" },
                            { name: "अधिभूत" }
                        ]
                    },
                    {
                        name: "स्थूल",
                        children: [
                            {
                                name: "परप्रणव ब्रह्म",
                                children: [
                                    { name: "ज्ञान शक्ति गायत्री" },
                                    { name: "पाँच वेद" }
                                ]
                            },
                            {
                                name: "अपर परप्रणव ब्रह्म",
                                children: [
                                    { name: "ॐ" }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                name: "केवल ब्रह्म",
                children: [
                    { name: "केवल ब्रह्म" },
                    { name: "आनंद योगमाया" },
                    { name: "हिंडोला योगमाया मंडल" }
                ]
            },
            {
                name: "सबलीक ब्रह्म",
                children: [
                    { name: "सबलीक ब्रह्म का महाकारण" },
                    { name: "अखंड महारास" },
                    { name: "नित्य गोलोक" }
                ]
            },
            {
                name: "क्षर पुरुष",
                children: [
                    {
                        name: "मोह जल",
                        children: [
                            {
                                name: "आदि नारायण (चार व्यूह)",
                                children: [
                                    { name: "वासुदेव" },
                                    { name: "संकर्षण" },
                                    { name: "प्रद्युम्न" },
                                    { name: "अनिरुद्ध" }
                                ]
                            },
                            {
                                name: "महाविष्णु",
                                children: [
                                    {
                                        name: "कारण शरीर",
                                        children: [
                                            { name: "उनमुनी शक्ति" },
                                            { name: "वास्तवि शक्ति" },
                                            { name: "अनिर्वचनीय शक्ति" },
                                            { name: "तृच्छा शक्ति" },
                                            { name: "शिव कल्याणी शक्ति" },
                                            { name: "सात शून्य" }
                                        ]
                                    },
                                    {
                                        name: "सूक्ष्म शरीर",
                                        children: [
                                            { name: "विद्या शक्ति" },
                                            { name: "महा विद्या शक्ति" },
                                            { name: "सुमना शक्ति" }
                                        ]
                                    },
                                    {
                                        name: "स्थूल शरीर",
                                        children: [
                                            { name: "ज्ञान शक्ति गायत्री" },
                                            { name: "चार वेद" }
                                        ]
                                    }
                                ]
                            },
                            {
                                name: "ज्योति स्वरूप (गायत्री)",
                                children: [
                                    { name: "चमोचक शक्ति" },
                                    { name: "इधीद्वीपा शक्ति" },
                                    { name: "मध्यमा शक्ति" },
                                    { name: "परमा शक्ति" },
                                    { name: "उध्द्रगा शक्ति" }
                                ]
                            },
                            {
                                name: "अष्ट आवरण (नित्य प्रलय)",
                                children: [
                                    {
                                        name: "पंचमहाभूत",
                                        children: [
                                            { name: "भूमि" },
                                            { name: "जल" },
                                            { name: "अग्नि" },
                                            { name: "वायु" },
                                            { name: "आकाश" }
                                        ]
                                    },
                                    {
                                        name: "अंतःकरण",
                                        children: [
                                            { name: "मन" },
                                            { name: "बुद्धि" },
                                            { name: "अहंकार" }
                                        ]
                                    }
                                ]
                            },
                            {
                                       name: "सात स्वर",
                                        children: [
                                            { name: "सा " },
                                            { name: "रे" },
                                            { name: "ग" },
                                            { name: "म" },
											{ name: "प" },
											{ name: "ध" },
                                            { name: "नी" }
                                        ]
                            },
							{
                                name: "लोक (ब्रह्मांड)",
                                children: [
                                    { name: "सत्यलोक" },
                                    { name: "तपलोक" },
                                    { name: "जनलोक" },
                                    { name: "महरलोक" },
                                    { name: "स्वर्गलोक" },
                                    { name: "भुवर्लोक" },
                                    { name: "भूलोक (पृथ्वी)" },
                                    { name: "अतल" },
                                    { name: "वितल" },
                                    { name: "सुतल" },
                                    { name: "तलातल" },
                                    { name: "महातल" },
                                    { name: "रसातल" },
                                    { name: "पाताल" },
                                    { name: "शेषशायी नारायण" }
                                ]
                            }
                        ]
                    }
                ]
            }
        ]
    };

// --- 3. D3 RENDER LOGIC ---
const width = window.innerWidth;
const height = window.innerHeight;

const svg = d3.select("#chart-container")
    .append("svg")
    .attr("width", "100%")
    .attr("height", "100vh");

const g = svg.append("g");

// ZOOM
const zoom = d3.zoom()
    .scaleExtent([0.1, 4])
    .on("zoom", e => g.attr("transform", e.transform));

svg.call(zoom);

// TREE
const tree = d3.tree().nodeSize([45, 280]);
const root = d3.hierarchy(treeData);

// COLLAPSE ALL
function collapseFull(d) {
    if (d.children) {
        d._children = d.children;
        d._children.forEach(collapseFull);
        d.children = null;
    }
}
collapseFull(root);

root.x0 = 0;
root.y0 = 0;

// CENTER
function getCenter() {
    return {
        x: window.innerHeight / 2,
        y: window.innerWidth / 2
    };
}

function centerPoint(x, y, scale = 0.7) {
    const c = getCenter();

    const t = d3.zoomIdentity
        .translate(
            c.y - y * scale,
            c.x - x * scale
        )
        .scale(scale);

    svg.transition()
        .duration(600)
        .call(zoom.transform, t);
}

function focusNewNodes(parent) {
    if (!parent.children || parent.children.length === 0) {
        centerPoint(parent.x, parent.y);
        return;
    }

    let sumX = 0;
    let sumY = 0;

    parent.children.forEach(c => {
        sumX += c.x;
        sumY += c.y;
    });

    centerPoint(
        sumX / parent.children.length,
        sumY / parent.children.length
    );
}


// UPDATE
let i = 0;
const tooltip = d3.select("#node-tooltip");

function update(source) {

    const nodes = tree(root).descendants();
    const links = tree(root).links();

    nodes.forEach(d => d.y = d.depth * 280);

    const node = g.selectAll("g.node")
        .data(nodes, d => d.id || (d.id = ++i));

    const nodeEnter = node.enter()
        .append("g")
        .attr("class", "node")
        .attr("transform", `translate(${source.y0},${source.x0})`)
        .on("click", (event, d) => {

    const hadChildren = !!d.children;

    if (d.children) {
        d._children = d.children;
        d.children = null;
    } else {
        d.children = d._children;
        d._children = null;
    }

    update(d);

    // ⚠️ layout complete होने के बाद focus
    requestAnimationFrame(() => {
        if (!hadChildren) {
            focusNewNodes(d);   // expand
        } else {
            centerPoint(d.x, d.y); // collapse
        }
    });
})

        .on("mousemove", (event, d) => {
            const info = nodeInfo[d.data.name] || "इस नोड की जानकारी उपलब्ध नहीं है।";
            tooltip
                .style("left", event.clientX + 12 + "px")
                .style("top", event.clientY + 12 + "px")
                .style("opacity", 1)
                .html(`<strong>${d.data.name}</strong><br>${info}`);
        })
        .on("mouseleave", () => tooltip.style("opacity", 0));

    nodeEnter.append("circle")
        .attr("r", 1e-6)
        .style("fill", d => d._children ? "var(--highlight)" : "#000");

    nodeEnter.append("text")
        .attr("dy", ".35em")
        .attr("x", d => d.children || d._children ? -18 : 18)
        .attr("text-anchor", d => d.children || d._children ? "end" : "start")
        .text(d => d.data.name);

    nodeEnter.merge(node)
        .transition()
        .duration(500)
        .attr("transform", d => `translate(${d.y},${d.x})`)
        .select("circle")
        .attr("r", 8)
        .style("fill", d => d._children ? "var(--highlight)" : "#000");

    node.exit().remove();

    const link = g.selectAll("path.link")
        .data(links, d => d.target.id);

    link.enter()
        .insert("path", "g")
        .attr("class", "link")
        .merge(link)
        .transition()
        .duration(500)
        .attr("d", d => `
            M ${d.source.y} ${d.source.x}
            C ${(d.source.y + d.target.y) / 2} ${d.source.x},
              ${(d.source.y + d.target.y) / 2} ${d.target.x},
              ${d.target.y} ${d.target.x}
        `);

    link.exit().remove();

    nodes.forEach(d => {
        d.x0 = d.x;
        d.y0 = d.y;
    });
}

// INIT
update(root);
centerPoint(root.x, root.y); 



// --- 4. ONBOARDING TUTORIAL LOGIC ---

function startOnboarding() {
    // 1. सबसे पहले पल्स एनीमेशन जोड़ें पहले नोड पर
    const rootNode = d3.select("g.node"); // यह पहला नोड पकड़ लेगा
    
    rootNode.insert("circle", ":first-child")
        .attr("class", "pulse-circle")
        .attr("r", 8);

    // 2. ट्यूटोरियल बॉक्स की पोजीशन सेट करें
    const box = document.getElementById("onboarding-box");
    
    // स्क्रीन के सेंटर के पास दिखाएं (क्योंकि root node सेंटर में आता है)
    box.style.display = "block";
    box.style.left = (window.innerWidth / 2 + 50) + "px";
    box.style.top = (window.innerHeight / 2 - 100) + "px";
}

function closeTutorial() {
    // ट्यूटोरियल बॉक्स छुपाएं
    document.getElementById("onboarding-box").style.display = "none";
    // पल्स एनीमेशन हटाएं
    d3.selectAll(".pulse-circle").remove();
}

// सब कुछ लोड होने के 1 सेकंड बाद ट्यूटोरियल शुरू करें
window.onload = () => {
    setTimeout(startOnboarding, 1000);
};